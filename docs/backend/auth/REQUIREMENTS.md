# WordMesh 身份认证模块业务需求（仅业务规则）

## 1. 目标

为终端用户提供安全、清晰、可审计的账户接入能力，覆盖注册、登录、令牌刷新（可选）与个人资料获取，确保一致的业务规则与可预期的结果。

## 2. 业务范围

- 账户注册（基于唯一用户名）
- 账户登录（基于用户名与密码）
- 获取当前用户资料（需已登录）
- 刷新访问凭证（默认启用，若关闭需运营确认）

不在本次范围：第三方登录、密码找回/重置、权限与角色管理、服务端会话撤销与黑名单、账号封禁策略细则。

## 3. 业务术语

- 账户：可登录系统的主体，由唯一用户名标识。
- 访问凭证：用于访问受保护资源的短期凭证。
- 刷新凭证（可选）：用于在访问凭证失效后获取新的访问凭证的长期凭证，无需维护黑名单。

## 4. 角色

- 终端用户：注册、登录并管理个人知识网络。
- 系统：根据业务规则对请求进行校验与应答，产生审计信息。

## 5. 业务规则

5.1 注册

- 用户名必须唯一；重复用户名注册应被拒绝。
- 用户名应满足长度与字符集规则（长度 3–32，允许字母数字下划线）。
- 密码必须满足最小长度（≥8）；若有更高复杂度要求，应按配置生效。
- 注册成功后返回用户的基本资料（不包含密码或敏感信息）。

  5.2 登录

- 登录请求必须同时提供用户名与密码。
- 当用户名不存在或密码不匹配时，系统应返回统一的“凭证无效”结果，不应暴露具体原因。
- 连续失败的登录尝试不应暴露可被枚举的信息；失败次数可被计数用于后续策略，但不影响本次返回格式。
- 登录成功后返回访问凭证；如系统启用了刷新机制，同时返回刷新凭证。

  5.3 获取当前用户资料（Profile）

- 仅对已登录用户开放。
- 应返回用户基本资料（不包含密码或敏感信息）。

  5.4 刷新访问凭证（默认启用）

- 请求必须提供有效的刷新凭证。
- 刷新操作仅在刷新凭证未过期、未失效的情况下成功。
- 刷新成功后返回新的访问凭证；原访问凭证的有效性按系统策略决定，不在本次规则中变更。

  5.5 错误与消息

- 对外错误应以业务含义表达，不泄露内部实现与数据细节。
- 参数校验失败应返回具体字段的提示信息列表（如字段名与失败原因）。

## 6. 业务场景与流程

6.1 注册流程（成功路径）

1. 用户提交用户名与密码。
2. 系统校验用户名与密码规则；用户名未被占用。
3. 系统创建账户并返回用户基本资料。

6.2 登录流程（成功路径）

1. 用户提交用户名与密码。
2. 系统校验账户存在且凭证匹配。
3. 系统返回访问凭证（与可选刷新凭证）。

6.3 获取资料（成功路径）

1. 用户发起资料查询请求。
2. 系统确认其已登录。
3. 系统返回用户基本资料。

6.4 刷新凭证（成功路径，默认启用）

1. 用户提交刷新凭证。
2. 系统确认刷新凭证仍有效。
3. 系统返回新的访问凭证。

## 7. 边界与异常场景（业务）

- 重复注册：当用户名已存在时，注册应被拒绝。
- 弱口令：当密码不满足最小长度或复杂度策略时，注册应被拒绝。
- 登录失败：用户名不存在或密码错误时，统一返回“凭证无效”。
- 未登录访问受保护资源：应被拒绝并提示需要登录。
- 刷新凭证无效/过期：刷新应被拒绝并提示重新登录。

## 8. 验收标准（业务）

- 注册、登录、资料查询、（可选）刷新四类能力均按规则稳定返回。
- 所有输入均进行业务层面的格式与约束校验，并返回清晰的错误信息。
- 对外不泄露内部实现细节与敏感数据。
- 错误文案一致、可被用户理解，且不助长恶意枚举。
